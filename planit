<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PLANIT | Strategic Intelligence Engine</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.263.0/lucide.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap');
        
        :root {
            --apple-blue: #007AFF;
            --ios-mesh: radial-gradient(at 0% 0%, rgba(0, 122, 255, 0.12) 0px, transparent 50%),
                         radial-gradient(at 100% 0%, rgba(255, 45, 85, 0.1) 0px, transparent 50%),
                         radial-gradient(at 100% 100%, rgba(88, 86, 214, 0.15) 0px, transparent 50%),
                         radial-gradient(at 0% 100%, rgba(255, 159, 10, 0.08) 0px, transparent 50%),
                         #ffffff;
            --glass-sheet: rgba(255, 255, 255, 0.85);
            --iphone-glass: linear-gradient(165deg, rgba(255, 255, 255, 0.4) 0%, rgba(255, 255, 255, 0.1) 100%);
            --slate-text: #1D1D1F;
        }

        * { box-sizing: border-box; }
        body { 
            font-family: 'Plus Jakarta Sans', -apple-system, sans-serif; 
            background: var(--ios-mesh);
            background-attachment: fixed;
            color: var(--slate-text);
            -webkit-font-smoothing: antialiased;
            margin: 0; padding: 0;
            overflow-x: hidden;
            width: 100%;
        }

        /* NAVIGATION */
        #main-nav {
            position: fixed; top: 0; left: 0; right: 0; z-index: 2000;
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(40px) saturate(180%);
            height: 72px;
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 5%; border-bottom: 1px solid rgba(0,0,0,0.04);
        }

        /* PREMIUM COVER SCROLL SNAPPING */
        #cover-container { height: 100vh; width: 100%; overflow-y: scroll; scroll-snap-type: y mandatory; scroll-behavior: smooth; background: #fff; }
        .snap-section { 
            height: 100vh; width: 100%; scroll-snap-align: start; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            padding: 2rem; position: relative; overflow: hidden;
            background: var(--ios-mesh);
        }
        
        .reveal-item { 
            opacity: 0; transform: translateY(40px) scale(0.98); 
            transition: all 1.2s cubic-bezier(0.16, 1, 0.3, 1); 
            z-index: 1; text-align: center;
        }
        .revealed .reveal-item { opacity: 1; transform: translateY(0) scale(1); }
        
        .acronym-hl { color: var(--apple-blue); font-weight: 900; }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.4);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.8);
            border-radius: 60px;
            padding: 4rem 6rem;
            box-shadow: 0 40px 100px rgba(0,0,0,0.03);
            display: flex; flex-direction: column; align-items: center;
            max-width: 900px;
        }

        .stat-giant { 
            font-size: clamp(5rem, 18vw, 14rem); font-weight: 900; line-height: 0.8; letter-spacing: -0.06em; margin-bottom: 2rem; 
            background: linear-gradient(180deg, var(--apple-blue) 0%, #4facfe 100%);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }

        .phase-headline { font-size: clamp(1.2rem, 3.5vh, 2.4rem); font-weight: 800; max-width: 800px; text-align: center; color: var(--slate-text); letter-spacing: -0.02em; line-height: 1.3; }
        .phase-subtext { font-size: 0.85rem; font-weight: 700; color: var(--apple-blue); text-transform: uppercase; letter-spacing: 0.25em; margin-bottom: 1.5rem; }

        /* Progress Indicator */
        #progress-nav {
            position: fixed; right: 40px; top: 50%; transform: translateY(-50%);
            display: flex; flex-direction: column; gap: 10px; z-index: 2500;
        }
        .dot { width: 6px; height: 6px; border-radius: 50%; background: rgba(0,0,0,0.08); transition: 0.4s cubic-bezier(0.16, 1, 0.3, 1); }
        .dot.active { height: 20px; border-radius: 10px; background: var(--apple-blue); box-shadow: 0 0 15px rgba(0,122,255,0.3); }

        /* PORTAL WORKSPACE */
        #main-app-shell { 
            display: none; width: 100%; min-height: 100vh; padding: 100px 5% 3rem; 
        }
        
        .workspace-plane {
            max-width: 1440px; margin: 0 auto; 
            background: var(--glass-sheet);
            backdrop-filter: blur(60px); border-radius: 44px; border: 1px solid rgba(255,255,255,1);
            padding: 2.5rem; 
            display: grid; 
            grid-template-columns: 1fr 360px; 
            gap: 3rem;
            box-shadow: 0 40px 100px rgba(0,0,0,0.04);
        }

        @media (max-width: 1100px) {
            .workspace-plane { grid-template-columns: 1fr; }
            .blueprint-side { position: static !important; width: 100%; margin-top: 2rem; }
        }

        /* PERSONALIZATION HEADER */
        .header-input-row { display: flex; flex-wrap: wrap; gap: 1.5rem; align-items: flex-end; width: 100%; margin-bottom: 2rem; }
        .name-container { flex: 1; min-width: 200px; max-width: 450px; }
        .age-container { width: 100px; flex-shrink: 0; }

        .choice-pill { background: rgba(0, 0, 0, 0.05); border-radius: 16px; padding: 10px 18px; cursor: pointer; transition: 0.3s; display: flex; align-items: center; gap: 8px; border: 1px solid rgba(255,255,255,0.05); white-space: nowrap; }
        .choice-pill.active { background: white; border-color: var(--apple-blue); box-shadow: 0 8px 16px rgba(0,122,255,0.12); }

        .quest-card {
            background: rgba(255, 255, 255, 0.6); border-radius: 28px; padding: 2rem;
            border: 2px solid rgba(0, 122, 255, 0.1); 
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 1.5rem; align-items: center; margin-bottom: 1.25rem; 
            box-shadow: 0 8px 30px rgba(0,0,0,0.02);
            animation: slideUp 0.4s ease forwards;
        }

        .ui-label { font-size: 10px; font-weight: 800; color: #636366; text-transform: uppercase; letter-spacing: 0.1em; margin-bottom: 8px; display: block; }
        .ui-input { 
            background: rgba(255, 255, 255, 0.98); border-radius: 14px; padding: 12px 18px; 
            font-size: 18px; font-weight: 800; color: #1C1C1E; width: 100%; 
            border: 2px solid rgba(0, 0, 0, 0.15); outline: none; transition: 0.2s; 
        }
        .ui-input:focus { background: white; border-color: var(--apple-blue); box-shadow: 0 0 0 5px rgba(0,122,255,0.1); }
        .ui-input.invalid { border-color: #FF3B30; background: #FFF2F2; animation: softPulse 1.2s infinite alternate; }

        @keyframes softPulse { from { border-color: #FF3B30; } to { border-color: #ff9d9d; } }
        
        .blueprint-side { background: var(--iphone-glass); backdrop-filter: blur(45px); border-radius: 40px; padding: 2.5rem; color: #1c1c1e; height: fit-content; box-shadow: 0 30px 60px rgba(0,0,0,0.1); border: 2.5px solid rgba(255, 255, 255, 0.8); position: sticky; top: 100px; }
        .num-main { font-size: clamp(24px, 4vw, 30px); font-weight: 800; letter-spacing: -0.04em; color: #1c1c1e; line-height: 1.1; margin-top: 5px; }
        .label-tiny { font-size: 10px; font-weight: 700; color: rgba(0,0,0,0.5); text-transform: uppercase; letter-spacing: 0.12em; }
        
        .breakup-list { margin-top: 10px; border-top: 1px dashed rgba(0,0,0,0.1); padding-top: 10px; display: flex; flex-direction: column; gap: 6px; }
        .breakup-item { display: flex; justify-content: space-between; font-size: 11px; font-weight: 600; color: rgba(0,0,0,0.6); }

        .portfolio-flow-container { border: 2.5px solid var(--apple-blue); border-radius: 36px; padding: 2.5rem; background: rgba(255, 255, 255, 0.95); margin-top: 3rem; transition: all 0.5s ease; position: relative; }
        .portfolio-flow-container.fullscreen { position: fixed; top: 0; left: 0; right: 0; bottom: 0; z-index: 3000; background: white; overflow-y: auto; border-radius: 0; padding: 4rem; border: none; }

        .advisor-wording { font-size: 15px; font-weight: 600; line-height: 1.7; color: #3A3A3C; background: #fff; padding: 1.75rem; border-radius: 24px; border: 1px solid #E5E7EB; margin-bottom: 2rem; box-shadow: 0 4px 20px rgba(0,0,0,0.02); }
        .hl-blue { color: #007AFF; font-weight: 800; }
        .hl-emerald { color: #34C759; font-weight: 800; }
        .hl-amber { color: #FF9500; font-weight: 800; }

        /* THE FIX: LEDGER STYLE EXPANDED ROWS WITH 3-COLUMN GRID */
        .logic-table-wrapper { width: 100%; overflow-x: auto; -webkit-overflow-scrolling: touch; border-radius: 16px; border: 1px solid #E5E7EB; }
        .logic-table { width: 100%; border-collapse: separate; border-spacing: 0; min-width: 1000px; }
        .logic-table th { text-align: left; padding: 14px; font-size: 11px; font-weight: 800; color: #6B7280; text-transform: uppercase; border-bottom: 1.5px solid #E5E7EB; background: #F9FAFB; border-right: 1px solid #E5E7EB; }
        .logic-table td { padding: 14px; font-size: 14px; font-weight: 700; border-bottom: 1px solid #E5E7EB; border-right: 1px solid #E5E7EB; cursor: pointer; transition: 0.2s; }
        .logic-table tr:hover:not(.m-flow-row) td { background: rgba(0, 122, 255, 0.04); }

        .m-flow-row { display: none; background: #F8FBFF; }
        .m-flow-row.active { display: table-row; }
        .m-cell-inner { 
            padding: 12px 60px; 
            display: grid; 
            grid-template-columns: 140px 240px 1fr; 
            gap: 15px;
            align-items: center;
            font-size: 13px; 
            color: #4B5563; 
            border-bottom: 1px solid rgba(0,0,0,0.04); 
            border-left: 4px solid var(--apple-blue);
        }
        .m-cell-inner span:nth-child(1) { font-weight: 800; color: #9CA3AF; }
        .m-cell-inner span:nth-child(2) { font-weight: 600; color: var(--slate-text); }
        .m-cell-inner span:nth-child(3) { font-weight: 800; color: var(--apple-blue); text-align: right; }

        .header-pill-btn { background: rgba(0, 0, 0, 0.05); color: #1D1D1F; padding: 10px 18px; border-radius: 100px; font-size: 12px; font-weight: 700; display: flex; align-items: center; gap: 8px; border: 1px solid rgba(0,0,0,0.05); transition: 0.2s; white-space: nowrap; }
        .header-pill-btn:hover { background: #1D1D1F; color: white; transform: translateY(-1px); }
        .btn-portal { background: var(--apple-blue); color: white; padding: 16px 36px; border-radius: 20px; font-weight: 800; font-size: 16px; transition: 0.3s; box-shadow: 0 10px 30px rgba(0,122,255,0.2); }
        .btn-portal:hover { transform: translateY(-2px); box-shadow: 0 15px 40px rgba(0,122,255,0.3); }

        .quick-pill { padding: 6px 12px; border-radius: 100px; font-size: 11px; font-weight: 800; cursor: pointer; background: rgba(0,0,0,0.05); border: 1px solid transparent; transition: 0.2s; }
        .quick-pill.active { background: var(--apple-blue); color: white; box-shadow: 0 4px 10px rgba(0,122,255,0.2); }

        .greeting-text { font-size: 18px; font-weight: 800; color: var(--apple-blue); min-height: 24px; margin-bottom: 5px; }

        @keyframes slideUp { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
        .no-scrollbar::-webkit-scrollbar { display: none; }

        #validToast { position: fixed; top: 100px; left: 50%; transform: translateX(-50%); background: #1D1D1F; color: white; padding: 12px 24px; border-radius: 100px; font-weight: 700; font-size: 13px; z-index: 5000; display: none; animation: slideUp 0.3s ease; border: 1px solid rgba(255,255,255,0.2); box-shadow: 0 20px 40px rgba(0,0,0,0.2); }
    </style>
</head>
<body class="no-scrollbar">

    <div id="validToast">Please enter your Name and Age first.</div>

    <!-- NAVIGATION -->
    <nav id="main-nav">
        <div class="flex items-center gap-3 cursor-pointer" onclick="navigate('cover')">
            <div class="flex flex-col">
                <span class="text-xl font-black tracking-tighter leading-none text-slate-900">PLANIT</span>
                <!-- Standard, colorful sub-brand tag -->
                <span class="text-[10px] font-bold text-slate-500 uppercase mt-1 tracking-wider leading-none">
                    Powered by <span class="text-blue-600 font-extrabold">Baba Tools</span>
                </span>
            </div>
        </div>
        <div class="flex items-center gap-4">
            <div class="hidden items-center gap-3" id="headerActions">
                <button onclick="exportPDF()" class="header-pill-btn pdf" style="border-color: #007AFF; color: #007AFF;"><i data-lucide="file-text" class="w-4 h-4"></i><span>Strategy Report</span></button>
                <button onclick="exportToExcel()" class="header-pill-btn excel"><i data-lucide="file-spreadsheet" class="w-4 h-4"></i><span>Excel Export</span></button>
                <button onclick="resetAll()" class="p-2.5 rounded-full hover:bg-rose-50 text-slate-400 hover:text-rose-500 transition"><i data-lucide="refresh-cw" class="w-4 h-4"></i></button>
            </div>
            <button id="header-portal-btn" onclick="launchApp()" class="header-pill-btn !bg-slate-900 !text-white !px-6 !py-2">Enter Portal</button>
        </div>
    </nav>

    <!-- PROGRESS INDICATOR -->
    <div id="progress-nav">
        <div class="dot active"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div>
        <div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div>
        <div class="dot"></div><div class="dot"></div><div class="dot"></div>
    </div>

    <!-- PREMIUM COVER JOURNEY -->
    <div id="cover-container" class="snap-container no-scrollbar">
        <!-- 1. HERO -->
        <section class="snap-section">
            <div class="reveal-item">
                <p class="phase-subtext">Precision Strategic Architecture</p>
                <h1 class="text-7xl md:text-[11rem] font-black tracking-tighter mb-2 leading-none text-slate-900">PLANIT</h1>
                <!-- Standard sized colorful branding -->
                <p class="text-sm font-bold text-slate-400 uppercase tracking-widest mb-12">
                    Powered by <span class="text-blue-600 font-black">Baba Tools</span>
                </p>
                <p class="text-xl md:text-3xl font-extrabold text-slate-700 uppercase tracking-tight leading-tight space-y-4">
                    <span class="acronym-hl">P</span>ersonal <span class="acronym-hl">L</span>ife <span class="acronym-hl">A</span>nd <span class="acronym-hl">N</span>vestment <span class="acronym-hl">I</span>ntelligence <span class="acronym-hl">T</span>ool
                </p>
                <div class="mt-16 animate-bounce opacity-20"><i data-lucide="chevron-down" class="w-8 h-8 mx-auto"></i></div>
            </div>
        </section>
        
        <!-- 2. THE HOOK -->
        <section class="snap-section">
            <div class="reveal-item">
                <h2 class="text-4xl md:text-7xl font-black mb-12 italic text-blue-600">‚ÄúPehele PLANIT.‚Äù</h2>
                <div class="max-w-4xl mx-auto space-y-16">
                    <p class="text-3xl md:text-5xl font-black uppercase tracking-tight text-slate-900">üòÑ ‚ÄúGoal ho ya dream ‚Äî <br><span class="text-blue-500">pehle PLANIT.‚Äù</span></p>
                    <div class="grid grid-cols-4 gap-12 pt-12 border-t border-slate-200 text-center">
                        <div class="hover:scale-110 transition-transform"><span class="text-5xl">üöó</span><p class="text-[10px] font-black text-slate-400 uppercase mt-4">Car</p></div>
                        <div class="hover:scale-110 transition-transform"><span class="text-5xl">üíç</span><p class="text-[10px] font-black text-slate-400 uppercase mt-4">Shaadi</p></div>
                        <div class="hover:scale-110 transition-transform"><span class="text-5xl">üè†</span><p class="text-[10px] font-black text-slate-400 uppercase mt-4">Ghar</p></div>
                        <div class="hover:scale-110 transition-transform"><span class="text-5xl">üèùÔ∏è</span><p class="text-[10px] font-black text-slate-400 uppercase mt-4">Retire</p></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 3. INFLATION -->
        <section class="snap-section">
            <div class="reveal-item stat-card">
                <p class="phase-subtext">The Wealth Eraser</p>
                <div class="stat-giant">92%</div>
                <p class="phase-headline">of investors fail because they ignore inflation. We factor it into every single milestone.</p>
            </div>
        </section>

        <!-- 4. HORIZONS -->
        <section class="snap-section">
            <div class="reveal-item stat-card">
                <p class="phase-subtext">Vague Objectives</p>
                <div class="stat-giant" style="background: linear-gradient(180deg, #FF9500 0%, #FFCC00 100%); -webkit-background-clip: text;">85%</div>
                <p class="phase-headline">undershoot targets due to vague time horizons. Precision timing is our core pillar.</p>
            </div>
        </section>

        <!-- 5. STATIC TRAP -->
        <section class="snap-section">
            <div class="reveal-item stat-card">
                <p class="phase-subtext">Capital Stagnation</p>
                <div class="stat-giant" style="background: linear-gradient(180deg, #AF52DE 0%, #D052DE 100%); -webkit-background-clip: text;">78%</div>
                <p class="phase-headline">remain stuck in static SIPs. Our Step-up engine multiplies your starting capital efficiency.</p>
            </div>
        </section>

        <!-- 6. STRATEGIC FOCUS -->
        <section class="snap-section">
            <div class="reveal-item stat-card">
                <p class="phase-subtext">Execution Drift</p>
                <div class="stat-giant" style="background: linear-gradient(180deg, #34C759 0%, #00D2D3 100%); -webkit-background-clip: text;">63%</div>
                <p class="phase-headline">lose strategic focus within 36 months. PLANIT provides a persistent roadmap to target.</p>
            </div>
        </section>

        <!-- 7. DELAY TAX -->
        <section class="snap-section">
            <div class="reveal-item stat-card">
                <p class="phase-subtext">Procrastination Penalty</p>
                <div class="stat-giant" style="background: linear-gradient(180deg, #FF3B30 0%, #FF2D55 100%); -webkit-background-clip: text;">54%</div>
                <p class="phase-headline">pay a massive "Wait Tax." Every month you delay increases your required starting effort.</p>
            </div>
        </section>

        <!-- 8. BLIND EXECUTION -->
        <section class="snap-section">
            <div class="reveal-item stat-card">
                <p class="phase-subtext">Algorithmic Error</p>
                <div class="stat-giant" style="background: linear-gradient(180deg, #5856D6 0%, #007AFF 100%); -webkit-background-clip: text;">44%</div>
                <p class="phase-headline">blindly trust generic online calculators. We provide personalized strategic architecture.</p>
            </div>
        </section>

        <!-- 9. WEALTH COMPLEXITY -->
        <section class="snap-section">
            <div class="reveal-item stat-card">
                <p class="phase-subtext">Portfolio Management</p>
                <div class="stat-giant" style="background: linear-gradient(180deg, #FF2D55 0%, #FF9500 100%); -webkit-background-clip: text;">39%</div>
                <p class="phase-headline">struggle with managing multiple goals. Our engine handles complex concurrent redemptions.</p>
            </div>
        </section>

        <!-- 10. REALIZATION WINDOW -->
        <section class="snap-section">
            <div class="reveal-item stat-card">
                <p class="phase-subtext">Discovery Gap</p>
                <div class="stat-giant" style="background: linear-gradient(180deg, #8E8E93 0%, #1D1D1F 100%); -webkit-background-clip: text;">19%</div>
                <p class="phase-headline">only realize their plan is flawed when it's too late. Discovery happens today.</p>
            </div>
        </section>

        <!-- 11. REDESIGNED CTA PHASE -->
        <section class="snap-section">
            <div class="reveal-item flex flex-col items-center">
                <p class="phase-subtext">The Standard of Success</p>
                <div class="stat-giant" style="background: linear-gradient(180deg, #007AFF 0%, #34C759 100%); -webkit-background-clip: text;">0%</div>
                <h2 class="text-3xl md:text-6xl font-black mb-8 leading-tight text-slate-900 text-center tracking-tight">Failure rate for those <br>who used <span class="text-blue-500 italic">PLANIT.</span></h2>
                <div class="flex items-center gap-3 mb-12 px-8 py-4 bg-emerald-50 rounded-3xl border border-emerald-100 shadow-sm animate-bounce">
                    <div class="p-1.5 bg-emerald-500 rounded-full"><i data-lucide="shield-check" class="text-white w-5 h-5"></i></div>
                    <span class="text-[11px] font-extrabold text-emerald-600 uppercase tracking-[0.2em]">Guaranteed by Precision Architecture</span>
                </div>
                <button onclick="launchApp()" class="btn-portal">Begin Strategy Session</button>
            </div>
        </section>
    </div>

    <!-- MAIN APP SHELL -->
    <div id="main-app-shell">
        <div class="workspace-plane">
            <!-- LEFT: INPUTS -->
            <div class="space-y-12 w-full overflow-hidden">
                <div class="header-input-row">
                    <div class="name-container">
                        <div id="greeting" class="greeting-text"></div>
                        <label class="ui-label">Enter your Name</label>
                        <input type="text" id="cName" placeholder="Baba" class="ui-input" oninput="updateGreeting()">
                    </div>
                    <div class="age-container">
                        <label class="ui-label">Age</label>
                        <input type="number" id="cAge" placeholder="30" class="ui-input" oninput="updateAge()">
                    </div>
                </div>

                <div class="flex flex-wrap gap-2 sm:gap-3">
                    <div class="choice-pill" id="tab-Car" onclick="toggleGoal('Car', 5)"><span>üöó</span><p>Car</p></div>
                    <div class="choice-pill" id="tab-Home" onclick="toggleGoal('Home', 7)"><span>üè†</span><p>Home</p></div>
                    <div class="choice-pill" id="tab-Wedding" onclick="toggleGoal('Wedding', 8)"><span>üíç</span><p>Wedding</p></div>
                    <div class="choice-pill" id="tab-Education" onclick="toggleGoal('Education', 10)"><span>üéì</span><p>Education</p></div>
                    <div class="choice-pill" id="tab-Retire" onclick="toggleGoal('Retire', 6)"><span>üèùÔ∏è</span><p>Retire</p></div>
                    <div class="choice-pill" id="tab-Custom" onclick="toggleGoal('Custom', 6)"><span>üéØ</span><p>Add Goal</p></div>
                </div>

                <div id="quest-stack" class="space-y-4 w-full"></div>

                <!-- ANALYSIS HUB -->
                <div class="portfolio-flow-container" id="portfolioContainer">
                    <div class="flex flex-wrap justify-between items-center gap-4 mb-8">
                        <div class="flex items-center gap-4">
                            <h3 class="text-xl font-extrabold tracking-tight" id="flowHeader">Portfolio Flow Analysis</h3>
                            <button id="toggleBtn" onclick="toggleAnalysis()" class="header-pill-btn !py-1.5 !px-3 text-[11px]" style="border-color: #007AFF; color: #007AFF;">
                                <span id="toggleText">Expand to see the flow</span>
                                <i data-lucide="chevron-down" id="toggleIcon" class="w-3.5 h-3.5 ml-1"></i>
                            </button>
                        </div>
                        <div class="flex flex-wrap gap-2">
                            <button onclick="exportToExcel()" class="header-pill-btn excel"><i data-lucide="file-spreadsheet" class="w-4 h-4"></i><span>Download Excel</span></button>
                            <button id="fsBtn" onclick="toggleFullscreen(event)" class="header-pill-btn"><i data-lucide="maximize" id="fsIcon" class="w-4 h-4"></i><span>Fullscreen</span></button>
                        </div>
                    </div>

                    <div id="flowContent" class="hidden animate-reveal">
                        <div id="strategy-advisor" class="advisor-wording">Enter goals to start.</div>

                        <div class="bg-white/60 p-6 rounded-[32px] border border-white shadow-sm mb-10 space-y-8">
                            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
                                <div><label class="ui-label">Lumpsum Boost (INR)</label><input type="number" id="flowLumpsum" value="0" oninput="updateConsolidated()" onfocus="if(this.value==='0')this.value='';" onblur="if(this.value==='')this.value='0';" class="ui-input"></div>
                                <div>
                                    <div class="flex justify-between mb-1"><label class="ui-label">Step-up (%)</label><span id="stepLabel" class="text-blue-600 font-bold">0%</span></div>
                                    <input type="number" id="flowStep" value="0" oninput="syncPills('step', this.value)" onfocus="if(this.value==='0')this.value='';" onblur="if(this.value==='')this.value='0';" class="ui-input">
                                    <div class="flex flex-wrap gap-1.5 mt-4" id="stepPills">
                                        <div class="quick-pill active" onclick="syncPills('step', 0)">0%</div>
                                        <div class="quick-pill" onclick="syncPills('step', 5)">5%</div>
                                        <div class="quick-pill" onclick="syncPills('step', 10)">10%</div>
                                        <div class="quick-pill" onclick="syncPills('step', 25)">25%</div>
                                        <div class="quick-pill" onclick="syncPills('step', 50)">50%</div>
                                    </div>
                                </div>
                                <div>
                                    <label class="ui-label">Assumed Returns (%)</label>
                                    <input type="number" id="flowReturns" value="12" oninput="syncPills('returns', this.value)" class="ui-input !text-emerald-600">
                                    <div class="flex flex-wrap gap-1.5 mt-4" id="returnPills">
                                        <div class="quick-pill" onclick="syncPills('returns', 8)">8%</div>
                                        <div class="quick-pill active" onclick="syncPills('returns', 12)">12%</div>
                                        <div class="quick-pill" onclick="syncPills('returns', 15)">15%</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="logic-table-wrapper no-scrollbar">
                            <table class="logic-table" id="sipFlowTable">
                                <thead><tr><th>Year</th><th>Age</th><th>Yearly Effort</th><th>Assumed Returns</th><th>Redemption</th><th>Net Valuation</th><th></th></tr></thead>
                                <tbody id="flowBody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- RIGHT: BLUEPRINT MONITOR SIDEBAR -->
            <div class="blueprint-side">
                <div id="fact-intelligence" class="bg-white/40 p-5 rounded-2xl text-[12px] border border-white/60 leading-relaxed text-black/80 mb-8">Ready to start? Enter details!</div>
                <div class="space-y-10">
                    <div id="fvSection">
                        <p class="label-tiny">Aggregate Target</p>
                        <p id="resFV" class="num-main">INR 0</p>
                        <div id="fvBreakup" class="breakup-list"></div>
                    </div>
                    <div id="sipSection">
                        <p class="label-tiny">Baseline Monthly SIP</p>
                        <p id="resSIP" class="num-main text-blue-600">INR 0</p>
                        <div id="sipBreakup" class="breakup-list"></div>
                    </div>
                    <div id="stepSection">
                        <p class="label-tiny">Step-up Starting Effort</p>
                        <p id="resStep" class="num-main text-emerald-600">INR 0</p>
                        <div id="stepBreakup" class="breakup-list"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const fmt = (n) => 'INR ' + new Intl.NumberFormat('en-IN', { maximumFractionDigits: 0 }).format(n);
        const sanitize = (n) => new Intl.NumberFormat('en-IN', { maximumFractionDigits: 0 }).format(n);
        const iconRefresh = () => { if(window.lucide) lucide.createIcons(); };

        let activeQuests = [];
        let currentFlowData = [];
        let lastValues = { fv: 0, sip: 0, step: 0 };

        function updateGreeting() {
            const nameInput = document.getElementById('cName');
            const name = nameInput.value;
            document.getElementById('greeting').innerText = name ? `Hi ${name}!` : "";
            nameInput.classList.remove('invalid');
            updateIntelligencePanel();
        }

        function updateAge() {
            const ageInput = document.getElementById('cAge');
            ageInput.classList.remove('invalid');
            updateIntelligencePanel();
        }

        function updateIntelligencePanel() {
            const name = document.getElementById('cName').value || 'Friend';
            const age = document.getElementById('cAge').value;
            const factEl = document.getElementById('fact-intelligence');
            if (!document.getElementById('cName').value && !age) {
                factEl.innerHTML = "Ready to start? Enter details!";
            } else if (activeQuests.length === 0) {
                factEl.innerHTML = `Hi <b>${name}</b>! Select your first strategy quest from the options above to activate the engine.`;
            }
        }

        function validateIdentity() {
            const name = document.getElementById('cName').value.trim();
            const age = document.getElementById('cAge').value;
            const toast = document.getElementById('validToast');
            if (!name || !age) {
                if(!name) document.getElementById('cName').classList.add('invalid');
                if(!age) document.getElementById('cAge').classList.add('invalid');
                toast.style.display = 'block';
                setTimeout(() => { toast.style.display = 'none'; }, 2500);
                return false;
            }
            return true;
        }

        function toggleAnalysis() {
            const content = document.getElementById('flowContent');
            const icon = document.getElementById('toggleIcon');
            const text = document.getElementById('toggleText');
            const isHidden = content.classList.contains('hidden');
            
            content.classList.toggle('hidden');
            text.innerText = isHidden ? "Collapse Analysis" : "Expand to see the flow";
            icon.setAttribute('data-lucide', isHidden ? 'chevron-up' : 'chevron-down');
            iconRefresh();
        }

        function toggleFullscreen(e) {
            if(e) e.stopPropagation();
            const el = document.getElementById('portfolioContainer');
            el.classList.toggle('fullscreen');
            const isFs = el.classList.contains('fullscreen');
            document.getElementById('fsBtn').querySelector('span').innerText = isFs ? "Minimize" : "Fullscreen";
            iconRefresh();
        }

        function animateValue(id, start, end, duration) {
            const obj = document.getElementById(id);
            if(!obj) return;
            let startTimestamp = null;
            const step = (timestamp) => {
                if (!startTimestamp) startTimestamp = timestamp;
                const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                const current = Math.floor(progress * (end - start) + start);
                obj.innerText = 'INR ' + sanitize(current);
                if (progress < 1) window.requestAnimationFrame(step);
            };
            window.requestAnimationFrame(step);
        }

        function syncPills(type, val) {
            if(type === 'step') {
                document.getElementById('flowStep').value = val;
                document.getElementById('stepLabel').innerText = val + '%';
                document.querySelectorAll('#stepPills .quick-pill').forEach(p => p.classList.toggle('active', parseInt(p.innerText) == val));
            } else {
                document.getElementById('flowReturns').value = val;
                document.querySelectorAll('#returnPills .quick-pill').forEach(p => p.classList.toggle('active', parseInt(p.innerText) == val));
            }
            updateConsolidated();
        }

        function launchApp() {
            document.getElementById('cover-container').style.display = 'none';
            document.getElementById('progress-nav').style.display = 'none';
            document.getElementById('main-app-shell').style.display = 'block';
            document.getElementById('header-portal-btn').style.display = 'none';
            document.getElementById('headerActions').classList.remove('hidden');
            document.getElementById('headerActions').classList.add('flex');
            updateConsolidated(); iconRefresh();
        }

        function navigate(view) { 
            if (view === 'cover') {
                document.getElementById('cover-container').style.display = 'block';
                document.getElementById('progress-nav').style.display = 'flex';
                document.getElementById('main-app-shell').style.display = 'none';
                document.getElementById('headerActions').classList.add('hidden');
                document.getElementById('header-portal-btn').style.display = 'block';
            } else {
                launchApp();
            }
        }

        function toggleGoal(type, inf) {
            if (!validateIdentity()) return;
            const idx = activeQuests.findIndex(q => q.type === type);
            if(idx > -1) activeQuests.splice(idx, 1);
            else activeQuests.push({ type, cost: 2500000, years: 10, inf, name: type });
            renderQuestStack(); updateConsolidated();
        }

        function renderQuestStack() {
            const stack = document.getElementById('quest-stack');
            stack.innerHTML = '';
            activeQuests.forEach((q, i) => {
                const card = document.createElement('div');
                card.className = 'quest-card animate-reveal';
                card.innerHTML = `
                    <div><label class="ui-label">Identity</label><input type="text" value="${q.name}" oninput="updateQuest(${i}, 'name', this.value)" class="ui-input"></div>
                    <div><label class="ui-label">Cost Today (INR)</label><input type="number" value="${q.cost}" oninput="updateQuest(${i}, 'cost', this.value)" class="ui-input"></div>
                    <div><label class="ui-label">Wait (Yrs)</label><input type="number" value="${q.years}" oninput="updateQuest(${i}, 'years', this.value)" class="ui-input"></div>
                    <div><label class="ui-label">Inflation %</label><input type="number" value="${q.inf}" oninput="updateQuest(${i}, 'inf', this.value)" class="ui-input !text-blue-600"></div>
                `;
                stack.appendChild(card);
            });
            const names = activeQuests.map(q => q.name).join(', ');
            document.getElementById('flowHeader').innerText = names ? `Analysis for ${names}` : "Portfolio Flow Analysis";
            ['Car','Home','Wedding','Education','Retire','Custom'].forEach(t => {
                const el = document.getElementById(`tab-${t}`);
                if(el) el.classList.toggle('active', !!activeQuests.find(q => q.type === t));
            });
        }

        function updateQuest(idx, key, val) {
            activeQuests[idx][key] = (key === 'name') ? val : parseFloat(val) || 0;
            updateConsolidated();
        }

        function updateConsolidated() {
            const userName = document.getElementById('cName').value || 'User';
            if(!activeQuests.length) {
                updateIntelligencePanel();
                return;
            }
            const lumpsum = parseFloat(document.getElementById('flowLumpsum').value) || 0;
            const stepUpRate = (parseFloat(document.getElementById('flowStep').value) || 0) / 100;
            const annualReturn = (parseFloat(document.getElementById('flowReturns').value) || 12) / 100;
            const r_m = Math.pow(1 + annualReturn, 1/12) - 1;

            let totalFV = 0, maxYears = 0;
            let breakups = { fv: [], sip: [], step: [] };

            activeQuests.forEach(q => {
                const fv = q.cost * Math.pow(1 + (q.inf/100), q.years);
                totalFV += fv;
                if(q.years > maxYears) maxYears = q.years;
                const sip_q = fv * r_m / ((Math.pow(1 + r_m, q.years * 12) - 1) * (1 + r_m));
                let low = 0, high = fv;
                for(let i=0; i<30; i++) {
                    let mid = (low+high)/2; let tot = 0, cur = mid;
                    for(let y=1; y<=q.years; y++) { tot += cur * ((Math.pow(1+r_m, 12)-1)/r_m) * (1+r_m) * Math.pow(1+annualReturn, q.years-y); cur *= (1+stepUpRate); }
                    if(tot < fv) low = mid; else high = mid;
                }
                breakups.fv.push({ name: q.name, val: fv });
                breakups.sip.push({ name: q.name, val: sip_q });
                breakups.step.push({ name: q.name, val: low });
            });

            const gap = Math.max(0, totalFV - (lumpsum * Math.pow(1 + annualReturn, maxYears)));
            const baselineSip = gap * r_m / ((Math.pow(1 + r_m, maxYears * 12) - 1) * (1 + r_m));
            let lowTotal = 0, highTotal = gap;
            for(let i=0; i<40; i++) {
                let mid = (lowTotal + highTotal) / 2; let total = 0, cur = mid;
                for(let yr = 1; yr <= maxYears; yr++) { total += cur * ((Math.pow(1 + r_m, 12) - 1) / r_m) * (1 + r_m) * Math.pow(1 + annualReturn, maxYears - yr); cur *= (1 + stepUpRate); }
                if(total < gap) lowTotal = mid; else highTotal = mid;
            }

            animateValue('resFV', lastValues.fv, totalFV, 500);
            animateValue('resSIP', lastValues.sip, baselineSip, 500);
            animateValue('resStep', lastValues.step, lowTotal, 500);
            lastValues = { fv: totalFV, sip: baselineSip, step: lowTotal };

            ['fv', 'sip', 'step'].forEach(key => {
                const container = document.getElementById(key + 'Breakup');
                container.innerHTML = activeQuests.length > 1 ? breakups[key].map(b => `<div class="breakup-item"><span>${b.name}</span><span>${fmt(b.val)}</span></div>`).join('') : '';
            });

            const questNames = activeQuests.map(q => q.name).join(' & ');
            document.getElementById('fact-intelligence').innerHTML = `<p class="mb-2 font-bold text-black uppercase text-[8px] tracking-widest opacity-40">Quest Insight Cycle</p>Hi <b>${userName}</b>! Planning for <b>${questNames}</b>? Check your roadmap below.`;
            
            let advisorHTML = `Hi <span class="hl-blue">${userName}</span>! `;
            if (lumpsum === 0 && stepUpRate === 0) {
                advisorHTML += `To reach your goal of <span class="hl-blue">${fmt(totalFV)}</span>, you'll need <span class="hl-emerald">${fmt(lowTotal)} per month</span>. <br><span class="hl-amber">Pro Tip:</span> Adding a small <span class="hl-amber">Lumpsum</span> and a <span class="hl-amber">Step-up</span> would be very helpful to achieve your goals with even less monthly effort!`;
            } else {
                advisorHTML += `With your current strategy, you only need to start with <span class="hl-emerald">${fmt(lowTotal)} per month</span> to achieve your total goal of <span class="hl-blue">${fmt(totalFV)}</span> comfortably!`;
            }
            document.getElementById('strategy-advisor').innerHTML = advisorHTML;
            renderFlowTable(maxYears, lowTotal, stepUpRate, lumpsum, annualReturn);
        }

        function renderFlowTable(years, startSip, stepRate, lum, annRet) {
            const body = document.getElementById('flowBody');
            body.innerHTML = ''; currentFlowData = [];
            let age = parseInt(document.getElementById('cAge').value) || 30;
            let portfolioValue = lum, currentSip = startSip;
            const r_m = Math.pow(1 + annRet, 1/12) - 1;

            for (let yr = 1; yr <= years; yr++) {
                let prevVal = portfolioValue;
                for (let m = 1; m <= 12; m++) { portfolioValue = (portfolioValue + currentSip) * (1 + r_m); }
                let returnsThisYear = portfolioValue - prevVal - (currentSip * 12);
                let redemptionThisYear = 0;
                let goalsRedeemed = [];
                activeQuests.forEach(q => {
                    if(q.years === yr) {
                        const fv = q.cost * Math.pow(1 + (q.inf/100), q.years);
                        redemptionThisYear += fv;
                        goalsRedeemed.push(q.name);
                    }
                });
                portfolioValue -= redemptionThisYear;

                const tr = document.createElement('tr');
                tr.innerHTML = `<td>Year ${yr}</td><td>${age + yr}</td><td>INR ${sanitize(currentSip * 12)}</td><td class="text-emerald-600">INR ${sanitize(returnsThisYear)}</td><td class="${redemptionThisYear > 0 ? 'text-rose-500' : 'text-slate-300'}">${redemptionThisYear > 0 ? '-' + sanitize(redemptionThisYear) : '0'}${goalsRedeemed.length > 0 ? `<div class="text-[9px] font-bold mt-1 opacity-80 uppercase">Goal: ${goalsRedeemed.join(', ')}</div>` : ''}</td><td class="text-blue-600 font-bold">INR ${sanitize(portfolioValue)}</td><td class="text-right"><button class="p-1"><i data-lucide="plus" class="w-4 h-4"></i></button></td>`;
                tr.onclick = () => document.getElementById(`m-${yr}`).classList.toggle('active');
                body.appendChild(tr);

                const mr = document.createElement('tr'); mr.id = `m-${yr}`; mr.className = 'm-flow-row';
                let mHtml = `<td colspan="7" class="!p-0">`;
                let mVal = prevVal;
                for(let m=1; m<=12; m++) {
                    mVal = (mVal + currentSip) * (1+r_m);
                    mHtml += `<div class="m-cell-inner"><span>Month ${m}</span><span>SIP: INR ${sanitize(currentSip)}</span><span class="font-bold text-blue-600">INR ${sanitize(mVal)}</span></div>`;
                    currentFlowData.push({ Year: yr, Month: m, Age: age+yr, "SIP Amount": currentSip, "Portfolio Value": mVal, "Redemption": (m===12 ? redemptionThisYear : 0), "Growth": (m===12 ? returnsThisYear : 0) });
                }
                mr.innerHTML = mHtml + `</td>`; body.appendChild(mr);
                currentSip *= (1 + stepRate);
            }
            iconRefresh();
        }

        function exportToExcel() {
            if(!currentFlowData.length) return;
            const ws = XLSX.utils.json_to_sheet(currentFlowData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Investment Roadmap");
            XLSX.writeFile(wb, "PLANIT_Strategy_Roadmap.xlsx");
        }
        
        function exportPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('p', 'pt', 'a4');
            const user = document.getElementById('cName').value || 'User';
            const age = document.getElementById('cAge').value || '30';
            const advisorText = document.getElementById('strategy-advisor').innerText;
            doc.setFont("helvetica", "bold"); doc.setFontSize(22); doc.text("PLANIT STRATEGIC REPORT", 40, 50);
            doc.setFontSize(10); doc.setTextColor(120); doc.text("Precision Wealth Architecture Powered by Baba Tools", 40, 65);
            doc.line(40, 75, 555, 75);
            doc.setTextColor(0); doc.setFontSize(11);
            doc.text(`Architect: ${user} (Age: ${age})`, 40, 100);
            doc.text("Future Consolidated Target: " + document.getElementById('resFV').innerText, 40, 120);
            doc.text("Starting Monthly SIP: " + document.getElementById('resStep').innerText, 40, 140);
            doc.setFont("helvetica", "bold"); doc.text("Strategy Quests:", 40, 170);
            let y = 185;
            activeQuests.forEach(q => { doc.setFont("helvetica", "normal"); doc.text(`${q.name}: INR ${sanitize(q.cost)} today, in ${q.years} years.`, 40, y); y += 18; });
            y += 20; doc.setFont("helvetica", "bold"); doc.text("Strategic Insight:", 40, y);
            const splitAdvice = doc.splitTextToSize(advisorText, 515);
            doc.setFont("helvetica", "normal"); doc.text(splitAdvice, 40, y + 15);
            const tableRows = currentFlowData.filter(d => d.Month === 12).map(d => [d.Year.toString(), d.Age.toString(), "INR " + sanitize(d["SIP Amount"] * 12), "INR " + sanitize(d.Growth), (d.Redemption > 0 ? "INR " + sanitize(d.Redemption) : "0"), "INR " + sanitize(d["Portfolio Value"])]);
            doc.autoTable({ startY: y + 35 + (splitAdvice.length * 15), head: [['Year', 'Age', 'Yearly Save', 'Returns', 'Redemption', 'Final Valuation']], body: tableRows, theme: 'striped', headStyles: { fillColor: [0, 122, 255] } });
            doc.save(`PLANIT_Strategy_Report_${user}.pdf`);
        }

        window.addEventListener('load', () => { 
            const obs = new IntersectionObserver((entries) => { 
                entries.forEach(e => { 
                    if (e.isIntersecting) {
                        e.target.classList.add('revealed');
                        // Update progress nav
                        const sections = Array.from(document.querySelectorAll('.snap-section'));
                        const index = sections.indexOf(e.target);
                        document.querySelectorAll('#progress-nav .dot').forEach((dot, i) => {
                            dot.classList.toggle('active', i === index);
                        });
                    }
                }); 
            }, { threshold: 0.5 });
            document.querySelectorAll('.snap-section').forEach(s => obs.observe(s));
            iconRefresh();
        });
        function navigate(view) { 
            if (view === 'cover') {
                document.getElementById('cover-container').style.display = 'block';
                document.getElementById('progress-nav').style.display = 'flex';
                document.getElementById('main-app-shell').style.display = 'none';
                document.getElementById('headerActions').classList.add('hidden');
                document.getElementById('header-portal-btn').style.display = 'block';
            } else {
                launchApp();
            }
        }
        function resetAll() { if(confirm("Clear All Intelligence?")) location.reload(); }
    </script>
</body>
</html>
